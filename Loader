local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local LocalPlayer = Players.LocalPlayer
local Camera = workspace.CurrentCamera

local Vector2_new = Vector2.new
local Vector3_new = Vector3.new
local math_clamp = math.clamp
local math_huge = math.huge
local tick = tick
local mousemove = mousemoverel or (Input and Input.MouseMove) or function() end

local ScriptActive = true
_G.AimbotEnabled = false
_G.TeamCheck = false 
_G.TargetPart = "Head"
_G.AimBind = Enum.KeyCode.E
_G.Smoothness = 1.0
_G.KillDelayEnabled = false
_G.DelayTime = 1.0
_G.ESP_Skeleton = false
_G.ESP_Box = false
_G.ESP_HeadCircle = false
_G.ESP_Tracers = false
_G.ESP_Color = Color3.fromRGB(170, 0, 255)

local ActiveButtons = {} 
local DrawPool = {}
local Row1 = {Color3.fromRGB(170, 0, 255), Color3.fromRGB(0, 255, 127), Color3.fromRGB(255, 50, 50), Color3.fromRGB(0, 255, 255)}
local Row2 = {Color3.fromRGB(255, 255, 0), Color3.fromRGB(255, 120, 0), Color3.fromRGB(255, 255, 255), Color3.fromRGB(0, 100, 255)}
local Row3 = {Color3.fromRGB(60, 0, 100), Color3.fromRGB(0, 20, 100), Color3.fromRGB(30, 60, 30), Color3.fromRGB(40, 40, 40)}

local LockedTarget = nil
local LastKillTime = 0

local function MakeDraggable(Frame)
    local Dragging, DragInput, DragStart, StartPos
    Frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            Dragging = true; DragStart = input.Position; StartPos = Frame.Position
            input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then Dragging = false end end)
        end
    end)
    Frame.InputChanged:Connect(function(input) if input.UserInputType == Enum.UserInputType.MouseMovement then DragInput = input end end)
    RunService.RenderStepped:Connect(function()
        if Dragging and DragInput then
            local Delta = DragInput.Position - DragStart
            Frame.Position = UDim2.new(StartPos.X.Scale, StartPos.X.Offset + Delta.X, StartPos.Y.Scale, StartPos.Y.Offset + Delta.Y)
        end
    end)
end

local function IsEnemy(Player)
    if not _G.TeamCheck then return true end
    if Player.Team ~= LocalPlayer.Team then return true end
    if Player.TeamColor ~= LocalPlayer.TeamColor then return true end
    if Player:GetAttribute("Team") ~= LocalPlayer:GetAttribute("Team") then return true end
    return false
end

local function IsBindDown()
    local bind = _G.AimBind
    if bind.EnumType == Enum.KeyCode then
        return UserInputService:IsKeyDown(bind)
    end
    return UserInputService:IsMouseButtonPressed(bind)
end

local function CreateDraw(type, props)
    local obj = Drawing.new(type)
    for i, v in pairs(props) do obj[i] = v end
    table.insert(DrawPool, obj)
    return obj
end

local SkeletonLines, Boxes, HeadCircles, Tracers = {}, {}, {}, {}
for i = 1, 300 do table.insert(SkeletonLines, CreateDraw("Line", {Thickness = 1.5, Visible = false})) end
for i = 1, 50 do
    table.insert(Boxes, CreateDraw("Square", {Thickness = 1.5, Visible = false}))
    table.insert(HeadCircles, CreateDraw("Circle", {Thickness = 1.5, Visible = false, Radius = 7}))
    table.insert(Tracers, CreateDraw("Line", {Thickness = 1.5, Visible = false}))
end

local Connections = {
    {"Head", "UpperTorso"}, {"UpperTorso", "LowerTorso"}, {"UpperTorso", "LeftUpperArm"},
    {"LeftUpperArm", "LeftLowerArm"}, {"UpperTorso", "RightUpperArm"}, {"RightUpperArm", "RightLowerArm"},
    {"LowerTorso", "LeftUpperLeg"}, {"LeftUpperLeg", "LeftLowerLeg"}, {"LowerTorso", "RightUpperLeg"}, {"RightUpperLeg", "RightLowerLeg"}
}

local function GetClosestTarget()
    if _G.KillDelayEnabled and (tick() - LastKillTime) < _G.DelayTime then return nil end
    local target, dist = nil, math_huge
    local mousePos = UserInputService:GetMouseLocation()
    local partName = _G.TargetPart

    for _, v in pairs(Players:GetPlayers()) do
        if v ~= LocalPlayer and v.Character and IsEnemy(v) then
            local pPart = v.Character:FindFirstChild(partName)
            if pPart then
                local pos, onS = Camera:WorldToViewportPoint(pPart.Position)
                if onS then
                    local mag = (Vector2_new(pos.X, pos.Y) - mousePos).Magnitude
                    if mag < dist then dist = mag; target = v end
                end
            end
        end
    end
    return target
end

local function BuildMenu()
    local Parent = (gethui and gethui()) or game:GetService("CoreGui")
    if Parent:FindFirstChild("CheozMenuAnim") then Parent.CheozMenuAnim:Destroy() end
    
    local sg = Instance.new("ScreenGui", Parent); sg.Name = "CheozMenuAnim"
    local main = Instance.new("CanvasGroup", sg)
    main.Size = UDim2.new(0, 550, 0, 480); main.BackgroundColor3 = Color3.fromRGB(15, 15, 15); main.BorderSizePixel = 0
    main.AnchorPoint = Vector2_new(0.5, 0.5); main.Position = UDim2.new(0.5, 0, 0.4, 0); main.GroupTransparency = 1 
    
    Instance.new("UICorner", main).CornerRadius = UDim.new(0, 10)
    local stroke = Instance.new("UIStroke", main); stroke.Thickness = 2.5; stroke.Color = _G.ESP_Color
    
    MakeDraggable(main)

    local closeBtn = Instance.new("TextButton", main)
    closeBtn.Size = UDim2.new(0, 30, 0, 30); closeBtn.Position = UDim2.new(1, -40, 0, 10)
    closeBtn.Text = "X"; closeBtn.TextColor3 = Color3.new(1,1,1); closeBtn.Font = Enum.Font.GothamBold; closeBtn.BackgroundColor3 = Color3.fromRGB(200, 50, 50); closeBtn.ZIndex = 10; Instance.new("UICorner", closeBtn)

    local title = Instance.new("TextLabel", main)
    title.Size = UDim2.new(1, 0, 0, 60); title.Text = "CHEOZ MENU"; title.TextColor3 = _G.ESP_Color; title.Font = Enum.Font.LuckiestGuy; title.TextSize = 30; title.BackgroundTransparency = 1

    local container = Instance.new("Frame", main)
    container.Size = UDim2.new(1, -20, 1, -80); container.Position = UDim2.new(0, 10, 0, 70); container.BackgroundTransparency = 1

    local function CreateSection(titleText, xPos)
        local sec = Instance.new("Frame", container); sec.Size = UDim2.new(0.48, 0, 0.95, 0); sec.Position = UDim2.new(xPos, 0, 0, 0); sec.BackgroundColor3 = Color3.fromRGB(22, 22, 22); Instance.new("UICorner", sec)
        local t = Instance.new("TextLabel", sec); t.Size = UDim2.new(1, 0, 0, 35); t.Text = titleText; t.TextColor3 = _G.ESP_Color; t.Font = Enum.Font.GothamBold; t.TextSize = 13; t.BackgroundTransparency = 1
        local list = Instance.new("Frame", sec); list.Size = UDim2.new(0.9, 0, 0.85, 0); list.Position = UDim2.new(0.05, 0, 0.12, 0); list.BackgroundTransparency = 1
        Instance.new("UIListLayout", list).Padding = UDim.new(0, 8); list.UIListLayout.SortOrder = Enum.SortOrder.LayoutOrder
        return list, t
    end

    local combatList, cT = CreateSection("COMBAT SYSTEM", 0)
    local visualList, vT = CreateSection("VISUALS & ESP", 0.52)

    local function MakeSlider(parent, txt, var, max, order)
        local f = Instance.new("Frame", parent); f.Size = UDim2.new(1, 0, 0, 45); f.BackgroundColor3 = Color3.fromRGB(30, 30, 30); f.Visible = false; f.LayoutOrder = order; Instance.new("UICorner", f)
        local tL = Instance.new("TextLabel", f); tL.Size = UDim2.new(1, 0, 0, 25); tL.Text = txt .. ": " .. string.format("%.1f", _G[var]); tL.TextColor3 = Color3.new(0.8,0.8,0.8); tL.BackgroundTransparency = 1; tL.TextSize = 12
        local sB = Instance.new("TextButton", f); sB.Size = UDim2.new(0.8, 0, 0, 4); sB.Position = UDim2.new(0.1, 0, 0.75, 0); sB.Text = ""; sB.BackgroundColor3 = Color3.fromRGB(50,50,50)
        local k = Instance.new("Frame", sB); k.Size = UDim2.new(0, 10, 0, 10); k.Position = UDim2.new(_G[var]/max, -5, 0.5, -5); k.BackgroundColor3 = _G.ESP_Color; Instance.new("UICorner", k)
        ActiveButtons[f] = function(color) k.BackgroundColor3 = color end
        sB.MouseButton1Down:Connect(function()
            local conn; conn = RunService.RenderStepped:Connect(function()
                if not UserInputService:IsMouseButtonPressed(Enum.UserInputType.MouseButton1) then conn:Disconnect() return end
                local rel = math_clamp((UserInputService:GetMouseLocation().X - sB.AbsolutePosition.X) / sB.AbsoluteSize.X, 0, 1)
                _G[var] = rel * max; k.Position = UDim2.new(rel, -5, 0.5, -5); tL.Text = txt .. ": " .. string.format("%.1f", _G[var])
            end)
        end)
        return f
    end

    local function MakeBtn(parent, txt, var, order, callback)
        local b = Instance.new("TextButton", parent); b.Size = UDim2.new(1, 0, 0, 35); b.BackgroundColor3 = Color3.fromRGB(35, 35, 35); b.Text = txt; b.TextColor3 = Color3.new(1,1,1); b.Font = Enum.Font.Gotham; b.TextSize = 13; b.LayoutOrder = order; Instance.new("UICorner", b)
        local function updateColor()
            if type(_G[var]) == "boolean" then
                b.BackgroundColor3 = _G[var] and _G.ESP_Color or Color3.fromRGB(35, 35, 35)
                b.TextColor3 = _G[var] and Color3.new(0,0,0) or Color3.new(1,1,1)
            end
        end
        ActiveButtons[b] = updateColor 
        b.MouseButton1Click:Connect(function() 
            if type(_G[var]) == "boolean" then _G[var] = not _G[var] end
            updateColor(); if callback then callback(_G[var]) end 
        end)
        updateColor()
        return b
    end

    local smS = MakeSlider(combatList, "Smoothness", "Smoothness", 1, 2)
    local targetBtn = MakeBtn(combatList, "Target: Head", "TargetPart", 0, function()
        if _G.TargetPart == "Head" then _G.TargetPart = "UpperTorso"
        elseif _G.TargetPart == "UpperTorso" then _G.TargetPart = "LeftLowerLeg"
        else _G.TargetPart = "Head" end
    end)
    RunService.RenderStepped:Connect(function() targetBtn.Text = "Target: " .. (_G.TargetPart == "UpperTorso" and "Body" or _G.TargetPart == "LeftLowerLeg" and "Legs" or "Head") end)

    local aimFrame = Instance.new("Frame", combatList); aimFrame.Size = UDim2.new(1, 0, 0, 35); aimFrame.BackgroundTransparency = 1; aimFrame.LayoutOrder = 1
    local aimBtn = MakeBtn(aimFrame, "Aim Bot", "AimbotEnabled", 1, function(v) smS.Visible = v end)
    aimBtn.Size = UDim2.new(0.7, -5, 1, 0)
    
    local kbBtn = Instance.new("TextButton", aimFrame); kbBtn.Size = UDim2.new(0.3, 0, 1, 0); kbBtn.Position = UDim2.new(0.7, 0, 0, 0); kbBtn.BackgroundColor3 = Color3.fromRGB(30, 30, 30); kbBtn.Text = "[".._G.AimBind.Name.."]"; kbBtn.TextColor3 = Color3.new(1,1,1); kbBtn.Font = Enum.Font.Gotham; kbBtn.TextSize = 10; Instance.new("UICorner", kbBtn)

    kbBtn.MouseButton1Click:Connect(function()
        kbBtn.Text = "[...]";
        local conn; conn = UserInputService.InputBegan:Connect(function(input)
            local itype = input.UserInputType
            if itype == Enum.UserInputType.Keyboard or itype == Enum.UserInputType.MouseButton2 or itype == Enum.UserInputType.MouseButton4 or itype == Enum.UserInputType.MouseButton5 then
                _G.AimBind = (itype == Enum.UserInputType.Keyboard) and input.KeyCode or itype
                kbBtn.Text = "[".._G.AimBind.Name.."]"; conn:Disconnect()
            end
        end)
    end)

    local dlS = MakeSlider(combatList, "Delay", "DelayTime", 3, 4)
    MakeBtn(combatList, "Kill Delay", "KillDelayEnabled", 3, function(v) dlS.Visible = v end)
    MakeBtn(combatList, "Team Check", "TeamCheck", 5)

    MakeBtn(visualList, "ESP Boxes", "ESP_Box", 1)
    MakeBtn(visualList, "ESP Skeleton", "ESP_Skeleton", 2)
    MakeBtn(visualList, "ESP Head", "ESP_HeadCircle", 3)
    MakeBtn(visualList, "ESP Tracers", "ESP_Tracers", 4)

    local function CreateColorRow(colors, order)
        local row = Instance.new("Frame", visualList); row.Size = UDim2.new(1, 0, 0, 30); row.BackgroundTransparency = 1; row.LayoutOrder = order
        Instance.new("UIListLayout", row).FillDirection = "Horizontal"; row.UIListLayout.HorizontalAlignment = "Center"; row.UIListLayout.Padding = UDim.new(0, 8)
        for _, col in pairs(colors) do
            local b = Instance.new("TextButton", row); b.Size = UDim2.new(0, 25, 0, 25); b.BackgroundColor3 = col; b.Text = ""; Instance.new("UICorner", b).CornerRadius = UDim.new(1, 0)
            b.MouseButton1Click:Connect(function()
                _G.ESP_Color = col; stroke.Color = col; title.TextColor3 = col; cT.TextColor3 = col; vT.TextColor3 = col;
                for btn, update in pairs(ActiveButtons) do update(col) end
            end)
        end
    end
    CreateColorRow(Row1, 6); CreateColorRow(Row2, 7); CreateColorRow(Row3, 8)

    local isOpen = false
    local function ToggleMenu()
        isOpen = not isOpen
        if isOpen then
            main.Visible = true; main.Size = UDim2.new(0, 500, 0, 430)
            TweenService:Create(main, TweenInfo.new(0.4, Enum.EasingStyle.Back, Enum.EasingDirection.Out), {Size = UDim2.new(0, 550, 0, 480), GroupTransparency = 0}):Play()
        else
            local t = TweenService:Create(main, TweenInfo.new(0.3, Enum.EasingStyle.Quart, Enum.EasingDirection.In), {Size = UDim2.new(0, 500, 0, 430), GroupTransparency = 1})
            t:Play(); t.Completed:Connect(function() if not isOpen then main.Visible = false end end)
        end
    end
    ToggleMenu() 
    UserInputService.InputBegan:Connect(function(i) if i.KeyCode == Enum.KeyCode.Insert then ToggleMenu() end end)
    closeBtn.MouseButton1Click:Connect(function() ScriptActive = false; for _, v in pairs(DrawPool) do v:Remove() end sg:Destroy() end)
end

RunService.RenderStepped:Connect(function()
    if not ScriptActive then return end
    local espCol = _G.ESP_Color
    for i = 1, 300 do SkeletonLines[i].Visible = false; SkeletonLines[i].Color = espCol end
    for i = 1, 50 do 
        Boxes[i].Visible = false; Boxes[i].Color = espCol
        HeadCircles[i].Visible = false; HeadCircles[i].Color = espCol
        Tracers[i].Visible = false; Tracers[i].Color = espCol
    end
    local sk_i, bx_i, hd_i, tr_i = 1, 1, 1, 1
    local viewportSize = Camera.ViewportSize
    for _, p in pairs(Players:GetPlayers()) do
        if p ~= LocalPlayer and p.Character and IsEnemy(p) then
            local root = p.Character:FindFirstChild("HumanoidRootPart")
            if root then
                local hrpPos, onS = Camera:WorldToViewportPoint(root.Position)
                if onS then
                    if _G.ESP_Box then
                        local head = p.Character:FindFirstChild("Head")
                        if head then
                            local hP = Camera:WorldToViewportPoint(head.Position + Vector3_new(0, 0.5, 0))
                            local lP = Camera:WorldToViewportPoint(root.Position - Vector3_new(0, 3, 0))
                            local h = math.abs(hP.Y - lP.Y); local w = h * 0.6
                            local b = Boxes[bx_i]; b.Visible = true; b.Size = Vector2_new(w, h); b.Position = Vector2_new(hrpPos.X - w/2, hrpPos.Y - h/2); bx_i = bx_i + 1
                        end
                    end
                    if _G.ESP_HeadCircle then
                        local head = p.Character:FindFirstChild("Head")
                        if head then
                            local hP = Camera:WorldToViewportPoint(head.Position)
                            local c = HeadCircles[hd_i]; c.Visible = true; c.Position = Vector2_new(hP.X, hP.Y); hd_i = hd_i + 1
                        end
                    end
                    if _G.ESP_Tracers then
                        local t = Tracers[tr_i]; t.Visible = true; t.From = Vector2_new(viewportSize.X/2, viewportSize.Y); t.To = Vector2_new(hrpPos.X, hrpPos.Y); tr_i = tr_i + 1
                    end
                    if _G.ESP_Skeleton then
                        for _, conn in pairs(Connections) do
                            local p1, p2 = p.Character:FindFirstChild(conn[1]), p.Character:FindFirstChild(conn[2])
                            if p1 and p2 then
                                local v1, o1 = Camera:WorldToViewportPoint(p1.Position); local v2, o2 = Camera:WorldToViewportPoint(p2.Position)
                                if (o1 or o2) and SkeletonLines[sk_i] then
                                    local s = SkeletonLines[sk_i]; s.Visible = true; s.From = Vector2_new(v1.X, v1.Y); s.To = Vector2_new(v2.X, v2.Y); sk_i = sk_i + 1
                                end
                            end
                        end
                    end
                end
            end
        end
    end
    if _G.AimbotEnabled and IsBindDown() then
        local t = LockedTarget or GetClosestTarget()
        if t and t.Character then
            local pPart = t.Character:FindFirstChild(_G.TargetPart)
            if pPart then
                LockedTarget = t; local targetPos, onS = Camera:WorldToViewportPoint(pPart.Position)
                if onS then
                    local mP = UserInputService:GetMouseLocation()
                    mousemove((targetPos.X - mP.X) * _G.Smoothness, (targetPos.Y - mP.Y) * _G.Smoothness)
                else LockedTarget = nil end
            else LockedTarget = nil end
        else 
            if LockedTarget then LastKillTime = tick() end; LockedTarget = nil 
        end
    else LockedTarget = nil end
end)

pcall(BuildMenu)
